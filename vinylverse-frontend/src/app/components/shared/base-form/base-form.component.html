<form [formGroup]="forma">
  <h2>{{ formaModel?.naziv }}</h2>

  @for (p of formaModel?.polja; track $index) {
    @if (p.tip === 'hidden') {}
    @else if (p.tip === 'textarea') {
      <div>
        <label>{{ p.labela }}:</label>
        <textarea [formControlName]="p.naziv" rows="4"></textarea>
      </div>
    }
    @else if (p.tip === 'pesme') {
      <div>
        <label>{{ p.labela }}:</label>
        <div class="pesma-unos">
          <input [(ngModel)]="novaPesma" [ngModelOptions]="{ standalone: true }" placeholder="Unesi pesmu" />
          <button type="button" (click)="dodajPesmu()">Dodaj</button>
        </div>
        <ul class="pesme-lista">
          <li *ngFor="let pesma of pesme; let i = index">
            {{ pesma }}
            <button type="button" (click)="ukloniPesmu(i)">✕</button>
          </li>
        </ul>
      </div>
    }
    @else if (p.tip === 'select') {
      <div>
        <label>{{ p.labela }}:</label>
        <select [formControlName]="p.naziv" [compareWith]="compareFn">
          <option [ngValue]="null" disabled selected>-- Izaberi --</option>
          @for (opcija of p.opcije; track $index) {
            <option [ngValue]="opcija">
              {{ p.displayFn ? p.displayFn(opcija) : opcija }}
            </option>
          }
        </select>
      </div>
    }
    @else {
      <div>
        <label>{{ p.labela }}:</label>
        <input [type]="p.tip" [formControlName]="p.naziv" />
      </div>
    }
  }

  <div *ngIf="prikaziUploadSlike" class="slika-upload">
    <label for="slika">Slika:</label>
    <input type="file" id="slika" accept="image/*" (change)="onFileSelected($event)" />

    <div *ngIf="imageChangedEvent" class="cropper-wrap">
      <image-cropper
        [imageChangedEvent]="imageChangedEvent"
        [maintainAspectRatio]="true"
        [aspectRatio]="1/1"
        [resizeToWidth]="800"
        [cropperMinWidth]="300"
        [cropperMinHeight]="300"
        [roundCropper]="false"
        format="png"
        (imageCropped)="onImageCropped($event)">
      </image-cropper>
    </div>

    <div class="preview-container" *ngIf="previewUrl">
      <p>Pregled slike:</p>
      <img [src]="previewUrl!" alt="Pregled slike" class="slika-preview" />
      <button type="button" class="btn-ukloni" (click)="ukloniSliku()">Ukloni sliku</button>
    </div>
  </div>

  <div>
    <button type="submit" (click)="onSubmit()">Submit</button>
    <button type="button" (click)="onCancel()">Otkaži</button>
  </div>
</form>
